# 新功能说明

## 功能概述

这个更新版本的支出跟踪系统具有以下新功能：

### 1. 外部API集成
- 主页会自动从 `https://1252702612-6e2319h9m9.ap-guangzhou.tencentscf.com` 获取当月实时数据
- 显示本周支出、本月支出、本周剩余预算、本月剩余预算
- 每30秒自动刷新数据

### 2. 历史月份管理
- 从2025年8月开始记录历史月份数据
- 当月数据由外部API提供，历史月份数据存储在本地数据库
- 支持手动编辑历史月份的支出总和

### 3. 简化的管理后台
- 移除了复杂的支出记录管理和CSV导入功能
- 专注于历史月份总和的管理
- 提供友好的编辑界面

## 数据流程

1. **当月数据**：从外部API实时获取，显示在主页的"实时支出统计"部分
2. **历史月份**：存储在 `monthly_totals` 表中，可通过管理后台编辑
3. **图表显示**：结合当月实时数据和历史数据，生成完整的月度支出趋势图

## 使用方法

### 初次部署
1. 部署到Cloudflare Pages
2. 访问管理后台 (`/admin.html`)
3. 点击"一键初始化数据库"按钮
4. 系统会自动创建从2025年8月到当前月份的所有月份记录（初始值为0）

### 日常使用
1. 主页会自动显示当月的实时支出数据
2. 通过管理后台可以编辑历史月份的支出总和
3. 图表会自动更新，显示历史趋势

## 数据库结构

### monthly_totals 表
- `id`: 主键
- `month`: 月份（YYYY-MM格式）
- `total_amount`: 支出总额
- `note`: 备注
- `created_at`: 创建时间
- `updated_at`: 更新时间

## API端点

- `GET /api/expenses`: 获取历史月份数据（排除当月）
- `GET /api/admin?action=list_monthly_totals`: 获取所有月份数据（管理员）
- `POST /api/admin`: 初始化数据库和更新月份数据

## 注意事项

1. 外部API如果无法访问，系统会继续正常工作，只是当月数据会显示为0
2. 历史月份数据完全由本地数据库管理，不受外部API影响
3. 系统会自动处理当月数据的更新，无需手动维护当月记录
